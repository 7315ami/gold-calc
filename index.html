<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gold Calculator</title>
  <style>
    :root{
      --bg:#f5f5f7;
      --card:#ffffff;
      --text:#111;
      --muted:#666;
      --line:#e6e6ea;
      --ok:#0b63ff;
      --bad:#d10f0f;
      --btn:#111;
      --btnText:#fff;
      --radius:18px;
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, "Noto Sans JP", sans-serif;
    }
    .wrap{
      max-width:720px;
      margin:0 auto;
      padding:14px 12px 28px;
    }
    .topbar{
      display:flex;
      gap:10px;
      align-items:flex-start;
      justify-content:space-between;
      margin-bottom:10px;
    }
    h1{
      margin:6px 0 2px;
      font-size:30px;
      letter-spacing:0.2px;
    }
    .sub{
      margin:0;
      color:var(--muted);
      font-size:14px;
    }
    .selectRow{
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width:160px;
      align-items:flex-end;
    }
    label.small{
      font-size:12px;
      color:var(--muted);
    }
    select{
      width:190px;
      max-width:52vw;
      font-size:16px;
      padding:10px 12px;
      border:1px solid var(--line);
      border-radius:12px;
      background:#fff;
    }

    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:14px;
      margin:10px 0;
    }
    .sectionTitle{
      margin:0 0 10px;
      font-weight:800;
      font-size:18px;
    }
    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    .row{
      display:grid;
      grid-template-columns: 1fr;
      gap:6px;
    }
    .row label{
      font-weight:700;
    }
    input{
      width:100%;
      padding:12px 12px;
      border:1px solid var(--line);
      border-radius:12px;
      font-size:18px;
      background:#fff;
    }
    .hint{
      margin:0;
      font-size:12px;
      color:var(--muted);
      line-height:1.35;
    }

    .btn{
      width:100%;
      padding:16px 14px;
      border:none;
      border-radius:16px;
      background:var(--btn);
      color:var(--btnText);
      font-size:20px;
      font-weight:800;
      cursor:pointer;
      margin-top:8px;
    }

    .bigNumbers{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    .kpi{
      border:1px solid var(--line);
      border-radius:16px;
      padding:12px;
      background:#fff;
    }
    .kpi .k{
      font-size:13px;
      color:var(--muted);
      margin-bottom:6px;
      font-weight:700;
    }
    .kpi .v{
      font-size:28px;
      font-weight:900;
      letter-spacing:0.2px;
      line-height:1.1;
      word-break:break-word;
    }
    .kpi .v.ok{ color:var(--ok); }
    .kpi .v.bad{ color:var(--bad); }

    details{
      border:1px solid var(--line);
      border-radius:16px;
      overflow:hidden;
      background:#fff;
    }
    summary{
      list-style:none;
      cursor:pointer;
      padding:12px 14px;
      font-weight:900;
      font-size:16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    summary::-webkit-details-marker{ display:none; }
    .chev{
      font-size:14px;
      color:var(--muted);
    }
    .detailsBody{
      padding:12px 14px 14px;
      border-top:1px solid var(--line);
    }

    .table{
      width:100%;
      border-collapse:collapse;
      font-size:14px;
    }
    .table tr + tr td{ border-top:1px dashed #e7e7ee; }
    .table td{
      padding:9px 0;
      vertical-align:top;
    }
    .table td:last-child{
      text-align:right;
      font-weight:800;
      white-space:nowrap;
      padding-left:10px;
    }

    .spacer{ height:6px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div>
        <h1 id="appTitle">ゴールド計算</h1>
        <p class="sub" id="appSub">シンプル・速い・ミスなし</p>
      </div>
      <div class="selectRow">
        <label class="small" id="langLabel">言語</label>
        <select id="lang">
          <option value="ja">日本語</option>
          <option value="en">English</option>
        </select>
      </div>
    </div>

    <!-- INPUTS -->
    <div class="card">
      <div class="grid">
        <div class="row">
          <label id="buyPerLbLabel">購入単価（GHS / Ghana pound）</label>
          <input id="buyPerLb" inputmode="decimal" placeholder="例：11000" />
          <p class="hint" id="buyPerLbHint">※ 1 Ghana pound あたりの価格</p>
        </div>

        <div class="row">
          <label id="weightLbLabel">重量（Ghana pound）</label>
          <input id="weightLb" inputmode="decimal" placeholder="例：10" />
        </div>

        <div class="row">
          <label id="weightGLabel">重量（g）</label>
          <input id="weightG" inputmode="decimal" placeholder="例：78" />
          <p class="hint" id="convHint">1 Ghana pound = 7.8 g（自動換算）</p>
        </div>

        <div class="row">
          <label id="fxLabel">為替（1 GHS → JPY）</label>
          <input id="fx" inputmode="decimal" placeholder="例：14.5" value="14.5" />
        </div>

        <div class="row">
          <label id="jpBuyLabel">日本の買取価格（JPY / g）</label>
          <input id="jpBuy" inputmode="decimal" placeholder="例：26000" value="26000" />
          <p class="hint" id="jpBuyHint">※ ここが「売上」を決めます</p>
        </div>

        <!-- Cost settings collapsible -->
        <details id="costSettings">
          <summary>
            <span id="costTitle">コスト設定（タップで開く）</span>
            <span class="chev">▼</span>
          </summary>
          <div class="detailsBody">
            <div class="grid">

              <div class="row">
                <label id="gbFeeLabel">Gold Board 手数料（%）</label>
                <input id="gbFee" inputmode="decimal" value="10" />
              </div>

              <div class="row">
                <label id="exportInsLabel">輸出・保険（%）</label>
                <input id="exportIns" inputmode="decimal" value="6" />
              </div>

              <div class="row">
                <label id="ghOtherLabel">ガーナ側 その他コスト（GHS）</label>
                <input id="ghOther" inputmode="decimal" value="0" />
                <p class="hint" id="ghOtherHint">※ 保管費、交通費など。無ければ 0。</p>
              </div>

              <div class="row">
                <label id="refinePerGLabel">精錬コスト（JPY / g）</label>
                <input id="refinePerG" inputmode="decimal" value="100" />
              </div>

              <div class="row">
                <label id="jpTaxLabel">日本側 税率（%）（例：消費税など）</label>
                <input id="jpTax" inputmode="decimal" value="10" />
                <p class="hint" id="jpTaxHint">※ 参考用。必要なければ 0。</p>
              </div>

              <div class="row">
                <label id="jpOtherLabel">日本側 その他コスト（JPY）</label>
                <input id="jpOther" inputmode="decimal" value="0" />
              </div>

            </div>
          </div>
        </details>

        <button class="btn" id="calcBtn">計算</button>
        <p class="hint" id="calcHint">ヒント：入力して「計算」。（入力中も自動更新します）</p>
      </div>
    </div>

    <!-- RESULTS (Big first) -->
    <div class="card">
      <p class="sectionTitle" id="resultTitle">結果</p>

      <div class="bigNumbers">
        <div class="kpi">
          <div class="k" id="needPayLabel">最終的に「支払う総額」（JPY）</div>
          <div class="v" id="needPayJpy">-</div>
        </div>

        <div class="kpi">
          <div class="k" id="profitLabel">最終利益（JPY）</div>
          <div class="v" id="profitJpy">-</div>
        </div>

        <div class="kpi">
          <div class="k" id="marginLabel">利益率（%）</div>
          <div class="v" id="marginPct">-</div>
        </div>

        <div class="kpi">
          <div class="k" id="revenueLabel">売上（日本買取）（JPY）</div>
          <div class="v" id="revenueJpy">-</div>
          <p class="hint" id="formulaHint">利益 = 売上 − 支払総額</p>
        </div>
      </div>

      <div class="spacer"></div>

      <!-- Breakdown collapsible -->
      <details id="breakdown">
        <summary>
          <span id="bdTitle">内訳（タップで開く）</span>
          <span class="chev">▼</span>
        </summary>
        <div class="detailsBody">
          <div class="grid">
            <div>
              <p class="sectionTitle" id="ghTitle">ガーナ側（GHS）</p>
              <table class="table">
                <tr><td id="ghBuyTotalK">購入合計</td><td id="ghBuyTotalV">-</td></tr>
                <tr><td id="ghGbFeeK">Gold Board 手数料</td><td id="ghGbFeeV">-</td></tr>
                <tr><td id="ghExpInsK">輸出・保険</td><td id="ghExpInsV">-</td></tr>
                <tr><td id="ghOtherK">その他コスト</td><td id="ghOtherV">-</td></tr>
                <tr><td id="ghTotalK"><b>ガーナ総コスト</b></td><td id="ghTotalV"><b>-</b></td></tr>
              </table>
              <p class="hint" id="ghWeightLine">重量：-</p>
            </div>

            <div>
              <p class="sectionTitle" id="jpTitle">日本側（JPY）</p>
              <table class="table">
                <tr><td id="jpCifK">CIF（参考）</td><td id="jpCifV">-</td></tr>
                <tr><td id="jpTaxK">税（参考）</td><td id="jpTaxV">-</td></tr>
                <tr><td id="jpRefineK">精錬コスト</td><td id="jpRefineV">-</td></tr>
                <tr><td id="jpOtherK2">日本その他</td><td id="jpOtherV2">-</td></tr>
                <tr><td id="jpTotalK"><b>日本総コスト</b></td><td id="jpTotalV"><b>-</b></td></tr>
                <tr><td id="fxLineK">為替</td><td id="fxLineV">-</td></tr>
              </table>
            </div>
          </div>
        </div>
      </details>
    </div>
  </div>

  <script>
    // ---------- helpers ----------
    const $ = (id) => document.getElementById(id);

    function num(v){
      if (v === null || v === undefined) return NaN;
      const s = String(v).replace(/,/g,'').trim();
      if (s === '') return NaN;
      const x = Number(s);
      return Number.isFinite(x) ? x : NaN;
    }

    function fmtInt(x){
      if (!Number.isFinite(x)) return '-';
      return new Intl.NumberFormat(undefined, {maximumFractionDigits:0}).format(Math.round(x));
    }

    function fmt2(x){
      if (!Number.isFinite(x)) return '-';
      return new Intl.NumberFormat(undefined, {minimumFractionDigits:2, maximumFractionDigits:2}).format(x);
    }

    function setVal(id, text){
      $(id).textContent = text;
    }

    function setKpi(id, value, isMoney=true){
      const el = $(id);
      el.classList.remove('ok','bad');
      el.textContent = value;
    }

    // ---------- i18n ----------
    const T = {
      ja: {
        appTitle:"ゴールド計算",
        appSub:"シンプル・速い・ミスなし",
        langLabel:"言語",
        buyPerLbLabel:"購入単価（GHS / Ghana pound）",
        buyPerLbHint:"※ 1 Ghana pound あたりの価格",
        weightLbLabel:"重量（Ghana pound）",
        weightGLabel:"重量（g）",
        convHint:"1 Ghana pound = 7.8 g（自動換算）",
        fxLabel:"為替（1 GHS → JPY）",
        jpBuyLabel:"日本の買取価格（JPY / g）",
        jpBuyHint:"※ ここが「売上」を決めます",
        costTitle:"コスト設定（タップで開く）",
        calcBtn:"計算",
        calcHint:"ヒント：入力して「計算」。（入力中も自動更新します）",
        gbFeeLabel:"Gold Board 手数料（%）",
        exportInsLabel:"輸出・保険（%）",
        ghOtherLabel:"ガーナ側 その他コスト（GHS）",
        ghOtherHint:"※ 保管費、交通費など。無ければ 0。",
        refinePerGLabel:"精錬コスト（JPY / g）",
        jpTaxLabel:"日本側 税率（%）（例：消費税など）",
        jpTaxHint:"※ 参考用。必要なければ 0。",
        jpOtherLabel:"日本側 その他コスト（JPY）",

        resultTitle:"結果",
        needPayLabel:"最終的に「支払う総額」（JPY）",
        profitLabel:"最終利益（JPY）",
        marginLabel:"利益率（%）",
        revenueLabel:"売上（日本買取）（JPY）",
        formulaHint:"利益 = 売上 − 支払総額",

        bdTitle:"内訳（タップで開く）",
        ghTitle:"ガーナ側（GHS）",
        jpTitle:"日本側（JPY）",
        ghBuyTotalK:"購入合計",
        ghGbFeeK:"Gold Board 手数料",
        ghExpInsK:"輸出・保険",
        ghOtherK:"その他コスト",
        ghTotalK:"ガーナ総コスト",
        ghWeightLinePrefix:"重量：",
        jpCifK:"CIF（参考）",
        jpTaxK:"税（参考）",
        jpRefineK:"精錬コスト",
        jpOtherK2:"日本その他",
        jpTotalK:"日本総コスト",
        fxLineK:"為替",
      },
      en: {
        appTitle:"Gold Calculator",
        appSub:"Simple, fast, no mistakes",
        langLabel:"Language",
        buyPerLbLabel:"Buy price (GHS / Ghana pound)",
        buyPerLbHint:"Price per 1 Ghana pound",
        weightLbLabel:"Weight (Ghana pound)",
        weightGLabel:"Weight (g)",
        convHint:"1 Ghana pound = 7.8 g (auto)",
        fxLabel:"FX (1 GHS → JPY)",
        jpBuyLabel:"Japan buy price (JPY / g)",
        jpBuyHint:"This sets the revenue.",
        costTitle:"Cost settings (tap to open)",
        calcBtn:"Calculate",
        calcHint:"Tip: Enter values and tap Calculate. (Auto updates while typing)",
        gbFeeLabel:"Gold Board fee (%)",
        exportInsLabel:"Export & insurance (%)",
        ghOtherLabel:"Other costs in Ghana (GHS)",
        ghOtherHint:"Storage, transport, etc. Use 0 if none.",
        refinePerGLabel:"Refining cost (JPY / g)",
        jpTaxLabel:"Japan tax rate (%) (e.g., VAT)",
        jpTaxHint:"For reference. Use 0 if not needed.",
        jpOtherLabel:"Other costs in Japan (JPY)",

        resultTitle:"Results",
        needPayLabel:"Total cash required (JPY)",
        profitLabel:"Profit (JPY)",
        marginLabel:"Profit margin (%)",
        revenueLabel:"Revenue (Japan buy) (JPY)",
        formulaHint:"Profit = Revenue − Total cost",

        bdTitle:"Breakdown (tap to open)",
        ghTitle:"Ghana side (GHS)",
        jpTitle:"Japan side (JPY)",
        ghBuyTotalK:"Purchase total",
        ghGbFeeK:"Gold Board fee",
        ghExpInsK:"Export & insurance",
        ghOtherK:"Other costs",
        ghTotalK:"Ghana total cost",
        ghWeightLinePrefix:"Weight: ",
        jpCifK:"CIF (ref.)",
        jpTaxK:"Tax (ref.)",
        jpRefineK:"Refining",
        jpOtherK2:"Japan other",
        jpTotalK:"Japan total cost",
        fxLineK:"FX",
      }
    };

    function applyLang(lang){
      const t = T[lang] || T.ja;
      $("appTitle").textContent = t.appTitle;
      $("appSub").textContent = t.appSub;
      $("langLabel").textContent = t.langLabel;

      $("buyPerLbLabel").textContent = t.buyPerLbLabel;
      $("buyPerLbHint").textContent = t.buyPerLbHint;
      $("weightLbLabel").textContent = t.weightLbLabel;
      $("weightGLabel").textContent = t.weightGLabel;
      $("convHint").textContent = t.convHint;
      $("fxLabel").textContent = t.fxLabel;
      $("jpBuyLabel").textContent = t.jpBuyLabel;
      $("jpBuyHint").textContent = t.jpBuyHint;

      $("costTitle").textContent = t.costTitle;
      $("calcBtn").textContent = t.calcBtn;
      $("calcHint").textContent = t.calcHint;

      $("gbFeeLabel").textContent = t.gbFeeLabel;
      $("exportInsLabel").textContent = t.exportInsLabel;
      $("ghOtherLabel").textContent = t.ghOtherLabel;
      $("ghOtherHint").textContent = t.ghOtherHint;
      $("refinePerGLabel").textContent = t.refinePerGLabel;
      $("jpTaxLabel").textContent = t.jpTaxLabel;
      $("jpTaxHint").textContent = t.jpTaxHint;
      $("jpOtherLabel").textContent = t.jpOtherLabel;

      $("resultTitle").textContent = t.resultTitle;
      $("needPayLabel").textContent = t.needPayLabel;
      $("profitLabel").textContent = t.profitLabel;
      $("marginLabel").textContent = t.marginLabel;
      $("revenueLabel").textContent = t.revenueLabel;
      $("formulaHint").textContent = t.formulaHint;

      $("bdTitle").textContent = t.bdTitle;
      $("ghTitle").textContent = t.ghTitle;
      $("jpTitle").textContent = t.jpTitle;

      $("ghBuyTotalK").textContent = t.ghBuyTotalK;
      $("ghGbFeeK").textContent = t.ghGbFeeK;
      $("ghExpInsK").textContent = t.ghExpInsK;
      $("ghOtherK").textContent = t.ghOtherK;
      $("ghTotalK").textContent = t.ghTotalK;
      $("jpCifK").textContent = t.jpCifK;
      $("jpTaxK").textContent = t.jpTaxK;
      $("jpRefineK").textContent = t.jpRefineK;
      $("jpOtherK2").textContent = t.jpOtherK2;
      $("jpTotalK").textContent = t.jpTotalK;
      $("fxLineK").textContent = t.fxLineK;

      // weight line prefix handled in calc()
    }

    // ---------- weight sync (pound <-> g) ----------
    const GRAMS_PER_POUND = 7.8;
    let lock = false;

    function syncFromLb(){
      if (lock) return;
      lock = true;
      const lb = num($("weightLb").value);
      if (Number.isFinite(lb)) {
        $("weightG").value = String(lb * GRAMS_PER_POUND);
      } else {
        // if cleared, clear the other as well
        if ($("weightLb").value.trim() === "") $("weightG").value = "";
      }
      lock = false;
      calc();
    }

    function syncFromG(){
      if (lock) return;
      lock = true;
      const g = num($("weightG").value);
      if (Number.isFinite(g)) {
        $("weightLb").value = String(g / GRAMS_PER_POUND);
      } else {
        if ($("weightG").value.trim() === "") $("weightLb").value = "";
      }
      lock = false;
      calc();
    }

    // ---------- main calc ----------
    function calc(){
      const lang = $("lang").value || "ja";
      const t = T[lang] || T.ja;

      const buyPerLb = num($("buyPerLb").value);          // GHS / pound
      const lb = num($("weightLb").value);               // pound
      const g = num($("weightG").value);                 // g

      const fx = num($("fx").value);                     // JPY per GHS
      const jpBuy = num($("jpBuy").value);               // JPY per g

      const gbFeePct = num($("gbFee").value) / 100;      // %
      const expInsPct = num($("exportIns").value) / 100; // %
      const ghOther = num($("ghOther").value);           // GHS

      const refinePerG = num($("refinePerG").value);     // JPY / g
      const jpTaxPct = num($("jpTax").value) / 100;      // %
      const jpOther = num($("jpOther").value);           // JPY

      // Determine effective weight (prefer g if available; else derive)
      let grams = NaN;
      let pounds = NaN;

      if (Number.isFinite(g)) {
        grams = g;
        pounds = g / GRAMS_PER_POUND;
      } else if (Number.isFinite(lb)) {
        pounds = lb;
        grams = lb * GRAMS_PER_POUND;
      }

      // Ghana costs
      const ghBuyTotal = (Number.isFinite(buyPerLb) && Number.isFinite(pounds)) ? (buyPerLb * pounds) : NaN;
      const ghGbFee = Number.isFinite(ghBuyTotal) && Number.isFinite(gbFeePct) ? (ghBuyTotal * gbFeePct) : NaN;
      const ghExpIns = Number.isFinite(ghBuyTotal) && Number.isFinite(expInsPct) ? (ghBuyTotal * expInsPct) : NaN;
      const ghOtherSafe = Number.isFinite(ghOther) ? ghOther : NaN;

      const ghTotal = (Number.isFinite(ghBuyTotal) ? ghBuyTotal : 0)
                    + (Number.isFinite(ghGbFee) ? ghGbFee : 0)
                    + (Number.isFinite(ghExpIns) ? ghExpIns : 0)
                    + (Number.isFinite(ghOtherSafe) ? ghOtherSafe : 0);

      const ghTotalValid = (Number.isFinite(ghBuyTotal) && Number.isFinite(pounds)) ? ghTotal : NaN;

      // Convert Ghana total to JPY (as part of "cash required")
      const ghTotalJpy = (Number.isFinite(ghTotalValid) && Number.isFinite(fx)) ? (ghTotalValid * fx) : NaN;

      // Japan costs (CIF ref: treat as Ghana total converted to JPY)
      const cifJpy = ghTotalJpy;
      const taxJpy = (Number.isFinite(cifJpy) && Number.isFinite(jpTaxPct)) ? (cifJpy * jpTaxPct) : NaN;
      const refineJpy = (Number.isFinite(grams) && Number.isFinite(refinePerG)) ? (grams * refinePerG) : NaN;

      const jpOtherValid = Number.isFinite(jpOther) ? jpOther : NaN;

      const jpTotal = (Number.isFinite(cifJpy) ? cifJpy : 0)
                    + (Number.isFinite(taxJpy) ? taxJpy : 0)
                    + (Number.isFinite(refineJpy) ? refineJpy : 0)
                    + (Number.isFinite(jpOtherValid) ? jpOtherValid : 0);

      const jpTotalValid = (Number.isFinite(cifJpy) && Number.isFinite(grams)) ? jpTotal : NaN;

      // Revenue & profit
      const revenue = (Number.isFinite(grams) && Number.isFinite(jpBuy)) ? (grams * jpBuy) : NaN;
      const profit = (Number.isFinite(revenue) && Number.isFinite(jpTotalValid)) ? (revenue - jpTotalValid) : NaN;

      // Profit margin: profit / cost (cash required)
      const margin = (Number.isFinite(profit) && Number.isFinite(jpTotalValid) && jpTotalValid !== 0) ? (profit / jpTotalValid * 100) : NaN;

      // ----- KPIs (big) -----
      const needPay = jpTotalValid;

      $("needPayJpy").textContent = Number.isFinite(needPay) ? (fmtInt(needPay) + " JPY") : "-";
      $("revenueJpy").textContent = Number.isFinite(revenue) ? (fmtInt(revenue) + " JPY") : "-";

      // profit color
      const profitEl = $("profitJpy");
      profitEl.textContent = Number.isFinite(profit) ? (fmtInt(profit) + " JPY") : "-";
      profitEl.classList.remove("ok","bad");
      if (Number.isFinite(profit)) {
        profitEl.classList.add(profit >= 0 ? "ok" : "bad");
      }

      const marginEl = $("marginPct");
      marginEl.textContent = Number.isFinite(margin) ? (fmt2(margin) + " %") : "-";
      marginEl.classList.remove("ok","bad");
      if (Number.isFinite(margin)) {
        marginEl.classList.add(margin >= 0 ? "ok" : "bad");
      }

      const needEl = $("needPayJpy");
      needEl.classList.remove("ok","bad");
      // cash required is always neutral; keep default

      // ----- Breakdown -----
      setVal("ghBuyTotalV", Number.isFinite(ghBuyTotal) ? (fmtInt(ghBuyTotal) + " GHS") : "-");
      setVal("ghGbFeeV", Number.isFinite(ghGbFee) ? (fmtInt(ghGbFee) + " GHS") : "-");
      setVal("ghExpInsV", Number.isFinite(ghExpIns) ? (fmtInt(ghExpIns) + " GHS") : "-");
      setVal("ghOtherV", Number.isFinite(ghOtherSafe) ? (fmtInt(ghOtherSafe) + " GHS") : "-");
      setVal("ghTotalV", Number.isFinite(ghTotalValid) ? (fmtInt(ghTotalValid) + " GHS") : "-");

      const wLine = (Number.isFinite(pounds) && Number.isFinite(grams))
        ? `${t.ghWeightLinePrefix}${fmt2(pounds)} pound = ${fmt2(grams)} g`
        : `${t.ghWeightLinePrefix}-`;
      $("ghWeightLine").textContent = wLine;

      setVal("jpCifV", Number.isFinite(cifJpy) ? (fmtInt(cifJpy) + " JPY") : "-");
      setVal("jpTaxV", Number.isFinite(taxJpy) ? (fmtInt(taxJpy) + " JPY") : "-");
      setVal("jpRefineV", Number.isFinite(refineJpy) ? (fmtInt(refineJpy) + " JPY") : "-");
      setVal("jpOtherV2", Number.isFinite(jpOtherValid) ? (fmtInt(jpOtherValid) + " JPY") : "-");
      setVal("jpTotalV", Number.isFinite(jpTotalValid) ? (fmtInt(jpTotalValid) + " JPY") : "-");

      setVal("fxLineV", Number.isFinite(fx) ? (`1 GHS → ${fmt2(fx)} JPY`) : "-");
    }

    // ---------- events ----------
    $("lang").addEventListener("change", () => {
      applyLang($("lang").value);
      calc();
    });

    $("calcBtn").addEventListener("click", calc);

    // Auto update
    const inputs = [
      "buyPerLb","fx","jpBuy","gbFee","exportIns","ghOther","refinePerG","jpTax","jpOther"
    ];
    inputs.forEach(id => $(id).addEventListener("input", calc));

    // weight sync: both directions
    $("weightLb").addEventListener("input", syncFromLb);
    $("weightG").addEventListener("input", syncFromG);

    // init
    applyLang("ja");
    calc();
  </script>
</body>
</html>