<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gold Calc</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; margin:16px; background:#fff; color:#111;}
    .top{display:flex; gap:12px; align-items:flex-end; justify-content:space-between; flex-wrap:wrap;}
    .title{font-size:28px; font-weight:900; line-height:1.1;}
    .sub{color:#666; margin-top:6px;}
    .row{margin:12px 0;}
    label{display:block; font-weight:800; margin:6px 0;}
    input, select{width:100%; padding:12px; font-size:18px; border:1px solid #ddd; border-radius:10px; box-sizing:border-box;}
    .grid{display:grid; gap:12px;}
    @media(min-width:720px){ .grid2{grid-template-columns:1fr 1fr;} }
    .card{border:1px solid #e6e6e6; border-radius:14px; padding:14px; background:#fff;}
    .btn{width:100%; padding:14px; font-size:20px; border-radius:14px; border:0; background:#111; color:#fff; font-weight:900;}
    .muted{color:#666; font-size:14px; margin-top:6px;}
    .resultBig{font-size:26px; font-weight:900; margin-top:10px;}
    .hr{height:1px; background:#eee; margin:12px 0;}
    details{border:1px solid #eee; border-radius:14px; padding:10px 12px; background:#fafafa;}
    summary{font-weight:900; font-size:18px; cursor:pointer; list-style:none;}
    summary::-webkit-details-marker{display:none;}
    .k{font-weight:900;}
    .kv{display:flex; justify-content:space-between; gap:10px; padding:8px 0; border-bottom:1px dashed #e6e6e6;}
    .kv:last-child{border-bottom:none;}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;}
  </style>
</head>
<body>

  <div class="top">
    <div>
      <div class="title" id="appTitle">ゴールド計算</div>
      <div class="sub" id="appSub">シンプル・速い・ミスなし</div>
    </div>
    <div style="min-width:220px;">
      <label id="langLabel">言語</label>
      <select id="lang">
        <option value="ja" selected>日本語</option>
        <option value="en">English</option>
      </select>
    </div>
  </div>

  <div class="row">
    <label id="modeLabel">モード</label>
    <select id="mode">
      <option value="normal" selected>通常（購入→日本売却→利益）</option>
      <option value="target">逆算（目標利益→最大買値）</option>
    </select>
    <div class="muted" id="modeHelp">計算したい方法を選んでください。</div>
  </div>

  <div class="card">
    <div class="k" id="inputTitle">入力</div>

    <!-- Ghana side -->
    <div class="row">
      <label id="buyPerPoundLabel">買値（GHS / Ghana pound）</label>
      <input id="buyPerPound" inputmode="decimal" placeholder="e.g. 11000" />
      <div class="muted" id="buyPerPoundHelp">ガーナは通常「pound単位」で価格が出る想定。</div>
    </div>

    <div class="grid grid2">
      <div class="row">
        <label id="weightPoundLabel">重量（Ghana pound）</label>
        <input id="weightPound" inputmode="decimal" placeholder="e.g. 10" />
      </div>
      <div class="row">
        <label id="weightGramLabel">重量（g）</label>
        <input id="weightGram" inputmode="decimal" placeholder="e.g. 78" />
        <div class="muted" id="weightHelp">1 Ghana pound = <span id="poundToGText">7.8</span> g（変更可能）</div>
      </div>
    </div>

    <div class="row">
      <label id="sellJpyLabel">売値（JPY / g）</label>
      <input id="sellJpyPerG" inputmode="decimal" placeholder="e.g. 26000" />
      <div class="muted" id="sellHelp">入れると最終利益まで出します。</div>
    </div>

    <div class="hr"></div>

    <!-- Collapsible cost settings -->
    <details id="costDetails">
      <summary id="costSummary">コスト設定（タップで開く）</summary>

      <div class="row">
        <label id="poundToGLabel">換算（1 Ghana pound → g）</label>
        <input id="poundToG" inputmode="decimal" value="7.8" />
      </div>

      <div class="row">
        <label id="fxLabel">為替（1 GHS → JPY）</label>
        <input id="fxGhsToJpy" inputmode="decimal" value="18" />
        <div class="muted" id="fxHelp">利益計算で使います（参考換算）。</div>
      </div>

      <div class="grid grid2">
        <div class="row">
          <label id="gbFeeLabel">Gold Board 手数料（%）</label>
          <input id="gbFeePct" inputmode="decimal" value="10" />
        </div>
        <div class="row">
          <label id="exportInsLabel">輸出・保険（%）</label>
          <input id="exportInsPct" inputmode="decimal" value="6" />
        </div>
      </div>

      <div class="row">
        <label id="ghanaOtherLabel">ガーナ側 その他コスト（GHS）</label>
        <input id="ghanaOtherGhs" inputmode="decimal" value="0" />
        <div class="muted" id="ghanaOtherHelp">保管費・移動費などがあれば入れる。無ければ0。</div>
      </div>

      <div class="grid grid2">
        <div class="row">
          <label id="refineLabel">精錬コスト（JPY / g）</label>
          <input id="refineJpyPerG" inputmode="decimal" value="100" />
        </div>
        <div class="row">
          <label id="jpTaxLabel">日本側 税率（%）（例：消費税など）</label>
          <input id="jpTaxPct" inputmode="decimal" value="10" />
        </div>
      </div>

      <div class="row">
        <label id="jpOtherLabel">日本側 その他コスト（JPY）</label>
        <input id="jpOtherJpy" inputmode="decimal" value="0" />
      </div>
    </details>

    <div class="row">
      <button class="btn" id="calcBtn">計算</button>
      <div class="muted" id="hint">ヒント：入力後に「計算」を押してください。</div>
    </div>
  </div>

  <div class="card" style="margin-top:12px;">
    <div class="k" id="resultTitle">結果</div>
    <div id="resultArea" class="muted">-</div>
  </div>

<script>
  // ---------- helpers ----------
  function num(v){
    const n = parseFloat(String(v ?? "").replace(/,/g,"").trim());
    return Number.isFinite(n) ? n : null;
  }
  function fmt(n, dp=0){
    if(!Number.isFinite(n)) return "-";
    return n.toLocaleString(undefined,{maximumFractionDigits:dp, minimumFractionDigits:dp});
  }

  // ---------- language ----------
  const T = {
    ja:{
      appTitle:"ゴールド計算", appSub:"シンプル・速い・ミスなし",
      langLabel:"言語", modeLabel:"モード",
      modeHelp:"計算したい方法を選んでください。",
      inputTitle:"入力",
      buyPerPoundLabel:"買値（GHS / Ghana pound）",
      buyPerPoundHelp:"ガーナは通常「pound単位」で価格が出る想定。",
      weightPoundLabel:"重量（Ghana pound）",
      weightGramLabel:"重量（g）",
      weightHelpPrefix:"1 Ghana pound = ",
      sellJpyLabel:"売値（JPY / g）",
      sellHelp:"入れると最終利益まで出します。",
      costSummary:"コスト設定（タップで開く）",
      poundToGLabel:"換算（1 Ghana pound → g）",
      fxLabel:"為替（1 GHS → JPY）",
      fxHelp:"利益計算で使います（参考換算）。",
      gbFeeLabel:"Gold Board 手数料（%）",
      exportInsLabel:"輸出・保険（%）",
      ghanaOtherLabel:"ガーナ側 その他コスト（GHS）",
      ghanaOtherHelp:"保管費・移動費などがあれば入れる。無ければ0。",
      refineLabel:"精錬コスト（JPY / g）",
      jpTaxLabel:"日本側 税率（%）（例：消費税など）",
      jpOtherLabel:"日本側 その他コスト（JPY）",
      calcBtn:"計算",
      hint:"ヒント：入力後に「計算」を押してください。",
      resultTitle:"結果",
      normal:"通常（購入→日本売却→利益）",
      target:"逆算（目標利益→最大買値）",
    },
    en:{
      appTitle:"Gold Calculator", appSub:"Simple, fast, no mistakes",
      langLabel:"Language", modeLabel:"Mode",
      modeHelp:"Choose how you want to calculate.",
      inputTitle:"Inputs",
      buyPerPoundLabel:"Buy price (GHS / Ghana pound)",
      buyPerPoundHelp:"Assume Ghana price is usually per pound unit.",
      weightPoundLabel:"Weight (Ghana pound)",
      weightGramLabel:"Weight (g)",
      weightHelpPrefix:"1 Ghana pound = ",
      sellJpyLabel:"Sell price (JPY / g)",
      sellHelp:"If you enter this, final profit is also shown.",
      costSummary:"Cost settings (tap to open)",
      poundToGLabel:"Conversion (1 Ghana pound → g)",
      fxLabel:"FX (1 GHS → JPY)",
      fxHelp:"Used for profit calculation (reference).",
      gbFeeLabel:"Gold Board fee (%)",
      exportInsLabel:"Export & insurance (%)",
      ghanaOtherLabel:"Other costs in Ghana (GHS)",
      ghanaOtherHelp:"Storage, transport, etc. Put 0 if none.",
      refineLabel:"Refining cost (JPY / g)",
      jpTaxLabel:"Japan tax rate (%) (e.g., VAT)",
      jpOtherLabel:"Other costs in Japan (JPY)",
      calcBtn:"Calculate",
      hint:"Tip: enter values then press Calculate.",
      resultTitle:"Result",
      normal:"Normal (buy → sell in Japan → profit)",
      target:"Reverse (target profit → max buy price)",
    }
  };

  const els = {
    lang:document.getElementById("lang"),
    mode:document.getElementById("mode"),
    appTitle:document.getElementById("appTitle"),
    appSub:document.getElementById("appSub"),
    langLabel:document.getElementById("langLabel"),
    modeLabel:document.getElementById("modeLabel"),
    modeHelp:document.getElementById("modeHelp"),
    inputTitle:document.getElementById("inputTitle"),
    buyPerPoundLabel:document.getElementById("buyPerPoundLabel"),
    buyPerPoundHelp:document.getElementById("buyPerPoundHelp"),
    weightPoundLabel:document.getElementById("weightPoundLabel"),
    weightGramLabel:document.getElementById("weightGramLabel"),
    weightHelp:document.getElementById("weightHelp"),
    poundToGText:document.getElementById("poundToGText"),
    sellJpyLabel:document.getElementById("sellJpyLabel"),
    sellHelp:document.getElementById("sellHelp"),
    costSummary:document.getElementById("costSummary"),
    poundToGLabel:document.getElementById("poundToGLabel"),
    fxLabel:document.getElementById("fxLabel"),
    fxHelp:document.getElementById("fxHelp"),
    gbFeeLabel:document.getElementById("gbFeeLabel"),
    exportInsLabel:document.getElementById("exportInsLabel"),
    ghanaOtherLabel:document.getElementById("ghanaOtherLabel"),
    ghanaOtherHelp:document.getElementById("ghanaOtherHelp"),
    refineLabel:document.getElementById("refineLabel"),
    jpTaxLabel:document.getElementById("jpTaxLabel"),
    jpOtherLabel:document.getElementById("jpOtherLabel"),
    calcBtn:document.getElementById("calcBtn"),
    hint:document.getElementById("hint"),
    resultTitle:document.getElementById("resultTitle"),
    resultArea:document.getElementById("resultArea"),
  };

  function applyLang(){
    const lang = els.lang.value;
    const t = T[lang];
    els.appTitle.textContent = t.appTitle;
    els.appSub.textContent = t.appSub;
    els.langLabel.textContent = t.langLabel;
    els.modeLabel.textContent = t.modeLabel;
    els.modeHelp.textContent = t.modeHelp;
    els.inputTitle.textContent = t.inputTitle;
    els.buyPerPoundLabel.textContent = t.buyPerPoundLabel;
    els.buyPerPoundHelp.textContent = t.buyPerPoundHelp;
    els.weightPoundLabel.textContent = t.weightPoundLabel;
    els.weightGramLabel.textContent = t.weightGramLabel;
    els.sellJpyLabel.textContent = t.sellJpyLabel;
    els.sellHelp.textContent = t.sellHelp;
    els.costSummary.textContent = t.costSummary;
    els.poundToGLabel.textContent = t.poundToGLabel;
    els.fxLabel.textContent = t.fxLabel;
    els.fxHelp.textContent = t.fxHelp;
    els.gbFeeLabel.textContent = t.gbFeeLabel;
    els.exportInsLabel.textContent = t.exportInsLabel;
    els.ghanaOtherLabel.textContent = t.ghanaOtherLabel;
    els.ghanaOtherHelp.textContent = t.ghanaOtherHelp;
    els.refineLabel.textContent = t.refineLabel;
    els.jpTaxLabel.textContent = t.jpTaxLabel;
    els.jpOtherLabel.textContent = t.jpOtherLabel;
    els.calcBtn.textContent = t.calcBtn;
    els.hint.textContent = t.hint;
    els.resultTitle.textContent = t.resultTitle;

    // mode option labels
    const m = els.mode;
    m.options[0].text = t.normal;
    m.options[1].text = t.target;

    // weight help
    const ptg = num(document.getElementById("poundToG").value) ?? 7.8;
    els.poundToGText.textContent = String(ptg);
    els.weightHelp.innerHTML = (t.weightHelpPrefix + `<span id="poundToGText">${ptg}</span> g`);
    // re-bind poundToGText
    els.poundToGText = document.getElementById("poundToGText");
  }

  els.lang.addEventListener("change", applyLang);

  // ---------- pound <-> g sync ----------
  const elPoundToG  = document.getElementById("poundToG");
  const elWeightP   = document.getElementById("weightPound");
  const elWeightG   = document.getElementById("weightGram");

  let lock = false;
  function syncFromPound(){
    if(lock) return;
    const p = num(elWeightP.value);
    const ptg = num(elPoundToG.value) ?? 7.8;
    if(p === null) return;
    lock = true;
    elWeightG.value = (p * ptg).toFixed(4).replace(/\.?0+$/,"");
    lock = false;
  }
  function syncFromGram(){
    if(lock) return;
    const g = num(elWeightG.value);
    const ptg = num(elPoundToG.value) ?? 7.8;
    if(g === null || ptg === 0) return;
    lock = true;
    elWeightP.value = (g / ptg).toFixed(6).replace(/\.?0+$/,"");
    lock = false;
  }

  elWeightP.addEventListener("input", syncFromPound);
  elWeightG.addEventListener("input", syncFromGram);
  elPoundToG.addEventListener("input", () => {
    // update help text & re-sync using current filled field
    const ptg = num(elPoundToG.value) ?? 7.8;
    if(els.poundToGText) els.poundToGText.textContent = String(ptg);
    if(elWeightP.value) syncFromPound();
    else if(elWeightG.value) syncFromGram();
  });

  // ---------- calculation ----------
  function buildKV(title, value){
    return `<div class="kv"><div>${title}</div><div class="mono">${value}</div></div>`;
  }

  function calcNormal(){
    const buyPerPound = num(document.getElementById("buyPerPound").value);
    const weightPound = num(elWeightP.value);
    const ptg = num(elPoundToG.value) ?? 7.8;

    const fx = num(document.getElementById("fxGhsToJpy").value);
    const gbPct = (num(document.getElementById("gbFeePct").value) ?? 0) / 100;
    const exPct = (num(document.getElementById("exportInsPct").value) ?? 0) / 100;
    const ghOther = num(document.getElementById("ghanaOtherGhs").value) ?? 0;

    const refine = num(document.getElementById("refineJpyPerG").value) ?? 0;
    const taxPct = (num(document.getElementById("jpTaxPct").value) ?? 0) / 100;
    const jpOther = num(document.getElementById("jpOtherJpy").value) ?? 0;

    const sellJpyPerG = num(document.getElementById("sellJpyPerG").value);

    if(buyPerPound === null || weightPound === null){
      return { ok:false, html:`<div class="muted">買値（GHS/pound）と重量（pound）を入れてください。</div>` };
    }

    const weightG = weightPound * ptg;

    // Ghana side
    const purchaseGhs = buyPerPound * weightPound;
    const gbFeeGhs = purchaseGhs * gbPct;
    const exportInsGhs = purchaseGhs * exPct;
    const ghanaTotalGhs = purchaseGhs + gbFeeGhs + exportInsGhs + ghOther;

    // Japan side (JPY)
    const cifJpy = (fx ? ghanaTotalGhs * fx : null); // reference conversion
    const taxJpy = (cifJpy !== null ? cifJpy * taxPct : null);
    const refineJpy = weightG * refine;
    const japanTotalJpy = (cifJpy !== null && taxJpy !== null) ? (cifJpy + taxJpy + refineJpy + jpOther) : null;

    // Revenue & profit
    const revenueJpy = (sellJpyPerG !== null) ? (sellJpyPerG * weightG) : null;
    const profitJpy = (revenueJpy !== null && japanTotalJpy !== null) ? (revenueJpy - japanTotalJpy) : null;

    let html = "";
    html += `<div class="resultBig">ガーナ総コスト: ${fmt(ghanaTotalGhs,0)} GHS</div>`;
    html += `<details style="margin-top:10px;"><summary>ガーナ内訳</summary>
      ${buildKV("購入合計", `${fmt(purchaseGhs,0)} GHS`)}
      ${buildKV("Gold Board 手数料", `${fmt(gbFeeGhs,0)} GHS`)}
      ${buildKV("輸出・保険", `${fmt(exportInsGhs,0)} GHS`)}
      ${buildKV("その他コスト", `${fmt(ghOther,0)} GHS`)}
      ${buildKV("重量", `${fmt(weightPound,6)} pound = ${fmt(weightG,2)} g`)}
    </details>`;

    if(fx){
      html += `<div class="resultBig" style="margin-top:12px;">日本総コスト: ${japanTotalJpy!==null?fmt(japanTotalJpy,0):"-"} JPY</div>`;
      html += `<details style="margin-top:10px;"><summary>日本内訳</summary>
        ${buildKV("CIF（参考）", `${fmt(cifJpy,0)} JPY`)}
        ${buildKV("税（参考）", `${fmt(taxJpy,0)} JPY`)}
        ${buildKV("精錬コスト", `${fmt(refineJpy,0)} JPY`)}
        ${buildKV("日本その他", `${fmt(jpOther,0)} JPY`)}
        ${buildKV("為替", `1 GHS → ${fmt(fx,2)} JPY`)}
      </details>`;
    } else {
      html += `<div class="muted" style="margin-top:10px;">※ 為替が未入力のため、日本円の総コストは計算しません。</div>`;
    }

    if(profitJpy !== null){
      html += `<div class="resultBig" style="margin-top:12px;">最終利益: ${fmt(profitJpy,0)} JPY</div>`;
      html += `<div class="muted mono">利益 = 売上(${fmt(revenueJpy,0)}) - 日本総コスト(${fmt(japanTotalJpy,0)})</div>`;
    } else if(sellJpyPerG !== null && japanTotalJpy === null){
      html += `<div class="muted" style="margin-top:10px;">※ 日本総コスト（JPY）が未計算のため、利益は出せません。</div>`;
    }

    return { ok:true, html };
  }

  function calcTarget(){
    // Reverse: target profit -> max buy price per pound (GHS/pound)
    const weightPound = num(elWeightP.value);
    const ptg = num(elPoundToG.value) ?? 7.8;

    const fx = num(document.getElementById("fxGhsToJpy").value);
    const gbPct = (num(document.getElementById("gbFeePct").value) ?? 0) / 100;
    const exPct = (num(document.getElementById("exportInsPct").value) ?? 0) / 100;
    const ghOther = num(document.getElementById("ghanaOtherGhs").value) ?? 0;

    const refine = num(document.getElementById("refineJpyPerG").value) ?? 0;
    const taxPct = (num(document.getElementById("jpTaxPct").value) ?? 0) / 100;
    const jpOther = num(document.getElementById("jpOtherJpy").value) ?? 0;

    const sellJpyPerG = num(document.getElementById("sellJpyPerG").value);
    const targetProfitJpy = num(document.getElementById("buyPerPound").value); // placeholder if user wants; but we won't use buyPerPound field in target mode.

    // We need target profit input. We'll reuse "ガーナ買値" field is NOT good.
    // For now keep it simple: show message.
    return { ok:false, html:`<div class="muted">逆算モードは次の段階で仕上げよう。まず通常モードの内訳を完成させた。</div>` };
  }

  function calc(){
    const mode = els.mode.value;
    if(mode === "normal"){
      const r = calcNormal();
      els.resultArea.innerHTML = r.html;
    } else {
      const r = calcTarget();
      els.resultArea.innerHTML = r.html;
    }
  }

  els.calcBtn.addEventListener("click", calc);
  applyLang();
</script>

</body>
</html>