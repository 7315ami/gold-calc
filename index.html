<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes" />
  <title>Gold Calc</title>
  <style>
    :root{
      --bg:#f6f7f9;
      --card:#fff;
      --text:#111;
      --muted:#666;
      --line:#e6e7ea;
      --accent:#111;
      --radius:16px;
    }
    *{box-sizing:border-box;}
    body{
      margin:0; padding:18px;
      background:var(--bg); color:var(--text);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif;
    }
    .wrap{max-width:720px; margin:0 auto;}
    .top{
      display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
      margin-bottom:12px;
    }
    h1{margin:0; font-size:28px; letter-spacing:0.2px;}
    .sub{color:var(--muted); margin-top:4px; font-size:14px;}
    .lang{
      display:flex; align-items:center; gap:8px;
    }
    select, input, button{
      font-size:16px; /* iOS input zoom防止 */
    }
    select{
      padding:10px 12px; border:1px solid var(--line);
      border-radius:12px; background:#fff; min-width:140px;
    }
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:14px;
      margin:12px 0;
    }
    .card h2{
      margin:0 0 10px 0;
      font-size:18px;
    }
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width:560px){
      .grid{grid-template-columns:1fr;}
      .top{flex-direction:column; align-items:stretch;}
      .lang{justify-content:flex-start;}
    }
    label{
      display:block;
      font-weight:700;
      margin:0 0 6px 0;
    }
    .hint{
      font-size:12px; color:var(--muted); margin-top:6px;
      line-height:1.35;
    }
    input{
      width:100%;
      padding:12px 12px;
      border:1px solid var(--line);
      border-radius:12px;
      background:#fff;
    }
    .rowline{
      border-top:1px solid var(--line);
      margin:12px 0;
    }
    .btn{
      width:100%;
      padding:14px 14px;
      border-radius:14px;
      border:0;
      background:#111;
      color:#fff;
      font-weight:800;
      cursor:pointer;
    }
    .summary{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    @media (max-width:560px){ .summary{grid-template-columns:1fr;} }
    .pill{
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      background:#fff;
    }
    .pill .k{color:var(--muted); font-size:12px; margin-bottom:6px;}
    .pill .v{font-size:20px; font-weight:900;}
    .pill .s{color:var(--muted); font-size:12px; margin-top:6px; line-height:1.35;}
    details{
      border:1px solid var(--line);
      border-radius:14px;
      background:#fff;
      padding:10px 12px;
    }
    summary{
      cursor:pointer;
      font-weight:900;
      list-style:none;
      outline:none;
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
    }
    summary::-webkit-details-marker{display:none;}
    .chev{color:var(--muted); font-weight:900;}
    .mini{
      font-size:13px; color:var(--muted);
      margin-top:8px;
      line-height:1.45;
    }
    .table{
      width:100%;
      border-collapse:collapse;
      margin-top:10px;
    }
    .table td{
      padding:8px 0;
      border-bottom:1px solid var(--line);
      vertical-align:top;
    }
    .table td:last-child{text-align:right; font-weight:800;}
    .warn{
      color:#b00020;
      font-weight:800;
      margin-top:8px;
      font-size:13px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div>
        <h1 id="tTitle">ゴールド計算</h1>
        <div class="sub" id="tSub">シンプル・速い・ミスなし</div>
      </div>
      <div class="lang">
        <div style="font-weight:800;" id="tLangLabel">言語</div>
        <select id="lang">
          <option value="ja">日本語</option>
          <option value="en">English</option>
        </select>
      </div>
    </div>

    <!-- 入力（最小） -->
    <div class="card">
      <h2 id="tInput">入力（最小）</h2>
      <div class="grid">
        <div>
          <label id="tPricePound">購入単価（GHS / Ghana pound）</label>
          <input id="buyPerPound" inputmode="decimal" placeholder="例：11000" />
          <div class="hint" id="tPriceHint"></div>
        </div>

        <div>
          <label id="tSellJPYg">日本の売値（JPY / g）</label>
          <input id="sellJPYg" inputmode="decimal" placeholder="例：27000" />
          <div class="hint" id="tSellHint"></div>
        </div>

        <div>
          <label id="tWeightPound">重量（Ghana pound）</label>
          <input id="weightPound" inputmode="decimal" placeholder="例：10" />
          <div class="hint" id="tWeightHint"></div>
        </div>

        <div>
          <label id="tWeightG">重量（g）</label>
          <input id="weightG" inputmode="decimal" placeholder="例：78" />
          <div class="hint" id="tConvertHint"></div>
        </div>

        <div>
          <label id="tFx">為替（1 GHS → JPY）</label>
          <input id="fx" inputmode="decimal" placeholder="例：18" />
          <div class="hint" id="tFxHint"></div>
        </div>

        <div style="display:flex; align-items:flex-end;">
          <button class="btn" id="calcBtn">計算</button>
        </div>
      </div>

      <div class="rowline"></div>

      <!-- 結果（最初にここを見る） -->
      <h2 id="tResult">結果（ここだけ見れば判断できる）</h2>
      <div class="summary">
        <div class="pill">
          <div class="k" id="kTotalCost">総コスト（JPY）</div>
          <div class="v" id="vTotalCost">-</div>
          <div class="s" id="sTotalCost">-</div>
        </div>
        <div class="pill">
          <div class="k" id="kRevenue">売上（JPY）</div>
          <div class="v" id="vRevenue">-</div>
          <div class="s" id="sRevenue">-</div>
        </div>
        <div class="pill">
          <div class="k" id="kProfit">利益（JPY）</div>
          <div class="v" id="vProfit">-</div>
          <div class="s" id="sProfit">-</div>
        </div>
        <div class="pill">
          <div class="k" id="kMargin">利益率</div>
          <div class="v" id="vMargin">-</div>
          <div class="s" id="sMargin">-</div>
        </div>
      </div>

      <div class="warn" id="warn"></div>
    </div>

    <!-- 内訳（タップで開く） -->
    <details class="card" id="detailWrap">
      <summary>
        <span id="tBreakdown">内訳（タップで開く）</span>
        <span class="chev" id="chev">▼</span>
      </summary>

      <div class="mini" id="tBreakdownMini"></div>

      <div style="margin-top:10px;">
        <h2 id="tCostSettings" style="margin-top:0;">コスト設定</h2>
        <div class="grid">
          <div>
            <label id="tGbPct">Gold Board 手数料（%）</label>
            <input id="gbPct" inputmode="decimal" />
          </div>
          <div>
            <label id="tExportPct">輸出・保険（%）</label>
            <input id="exportPct" inputmode="decimal" />
          </div>
          <div>
            <label id="tOtherGhs">ガーナ側 その他コスト（GHS）</label>
            <input id="otherGhs" inputmode="decimal" />
          </div>
          <div>
            <label id="tTaxPct">日本側 税率（%）</label>
            <input id="taxPct" inputmode="decimal" />
          </div>
          <div>
            <label id="tRefine">精錬コスト（JPY / g）</label>
            <input id="refineJPYg" inputmode="decimal" />
          </div>
          <div>
            <label id="tOtherJpy">日本側 その他コスト（JPY）</label>
            <input id="otherJpy" inputmode="decimal" />
          </div>
        </div>
      </div>

      <div class="rowline"></div>

      <h2 id="tGhanaSide">ガーナ側（GHS）</h2>
      <table class="table">
        <tr><td id="g1">購入合計</td><td id="gBuy">-</td></tr>
        <tr><td id="g2">Gold Board 手数料</td><td id="gGb">-</td></tr>
        <tr><td id="g3">輸出・保険</td><td id="gExp">-</td></tr>
        <tr><td id="g4">その他コスト</td><td id="gOther">-</td></tr>
        <tr><td id="g5" style="font-weight:900;">ガーナ総コスト</td><td id="gTotal">-</td></tr>
      </table>

      <h2 id="tJapanSide">日本側（JPY）</h2>
      <table class="table">
        <tr><td id="j1">CIF課税対象額（参考）</td><td id="jCIF">-</td></tr>
        <tr><td id="j2">消費税</td><td id="jTax">-</td></tr>
        <tr><td id="j3">精錬コスト</td><td id="jRefine">-</td></tr>
        <tr><td id="j4">その他コスト</td><td id="jOther">-</td></tr>
        <tr><td id="j5" style="font-weight:900;">日本総コスト</td><td id="jTotal">-</td></tr>
      </table>
    </details>

    <div class="mini" style="margin-top:10px;" id="footerNote"></div>
  </div>

<script>
(() => {
  // 固定：1 Ghana pound = 7.8 g
  const GRAMS_PER_POUND = 7.8;

  const $ = (id) => document.getElementById(id);

  // Inputs
  const lang = $("lang");
  const buyPerPound = $("buyPerPound");
  const sellJPYg = $("sellJPYg");
  const weightPound = $("weightPound");
  const weightG = $("weightG");
  const fx = $("fx");
  const calcBtn = $("calcBtn");

  // Settings (collapsed)
  const gbPct = $("gbPct");
  const exportPct = $("exportPct");
  const otherGhs = $("otherGhs");
  const taxPct = $("taxPct");
  const refineJPYg = $("refineJPYg");
  const otherJpy = $("otherJpy");

  // Outputs (top)
  const vTotalCost = $("vTotalCost");
  const sTotalCost = $("sTotalCost");
  const vRevenue = $("vRevenue");
  const sRevenue = $("sRevenue");
  const vProfit = $("vProfit");
  const sProfit = $("sProfit");
  const vMargin = $("vMargin");
  const sMargin = $("sMargin");
  const warn = $("warn");

  // Breakdown outputs
  const gBuy = $("gBuy");
  const gGb = $("gGb");
  const gExp = $("gExp");
  const gOther = $("gOther");
  const gTotal = $("gTotal");

  const jCIF = $("jCIF");
  const jTax = $("jTax");
  const jRefine = $("jRefine");
  const jOther = $("jOther");
  const jTotal = $("jTotal");

  // Text labels
  const i18n = {
    ja: {
      title:"ゴールド計算",
      sub:"シンプル・速い・ミスなし",
      langLabel:"言語",
      input:"入力（最小）",
      pricePound:"購入単価（GHS / Ghana pound）",
      priceHint:`※ 自動換算：1 Ghana pound = ${GRAMS_PER_POUND} g（表示だけ）`,
      sellJPYg:"日本の売値（JPY / g）",
      sellHint:"※ ここを入れると売上と利益が出ます。",
      weightPound:"重量（Ghana pound）",
      weightHint:"※ Ghana pound と g は連動します。",
      weightG:"重量（g）",
      convertHint:`※ 1 Ghana pound = ${GRAMS_PER_POUND} g で連動`,
      fx:"為替（1 GHS → JPY）",
      fxHint:"※ 利益計算の換算に使用。",
      calc:"計算",
      result:"結果（ここだけ見れば判断できる）",
      kTotalCost:"総コスト（JPY）",
      kRevenue:"売上（JPY）",
      kProfit:"利益（JPY）",
      kMargin:"利益率",
      breakdown:"内訳（タップで開く）",
      breakdownMini:"まず上の結果で判断 → 必要ならここで内訳を確認。",
      costSettings:"コスト設定",
      gbPct:"Gold Board 手数料（%）",
      exportPct:"輸出・保険（%）",
      otherGhs:"ガーナ側 その他コスト（GHS）",
      taxPct:"日本側 税率（%）",
      refine:"精錬コスト（JPY / g）",
      otherJpy:"日本側 その他コスト（JPY）",
      ghanaSide:"ガーナ側（GHS）",
      japanSide:"日本側（JPY）",
      g1:"購入合計",
      g2:"Gold Board 手数料",
      g3:"輸出・保険",
      g4:"その他コスト",
      g5:"ガーナ総コスト",
      j1:"CIF課税対象額（参考）",
      j2:"消費税",
      j3:"精錬コスト",
      j4:"その他コスト",
      j5:"日本総コスト",
      footer:`注：CIF課税対象額は「ガーナ総コスト（GHS）×為替」を参考値として表示しています。`,
      warnNeed:"未入力があります。最低限「購入単価」「重量（pound か g）」「為替」「日本の売値」を入れると判断できます。"
    },
    en: {
      title:"Gold Calculator",
      sub:"Simple, fast, no mistakes",
      langLabel:"Language",
      input:"Inputs (minimum)",
      pricePound:"Buy price (GHS / Ghana pound)",
      priceHint:`Auto conversion: 1 Ghana pound = ${GRAMS_PER_POUND} g (info only)`,
      sellJPYg:"Sell price in Japan (JPY / g)",
      sellHint:"Enter this to show revenue & profit.",
      weightPound:"Weight (Ghana pound)",
      weightHint:"Ghana pound and g are linked.",
      weightG:"Weight (g)",
      convertHint:`Linked by 1 Ghana pound = ${GRAMS_PER_POUND} g`,
      fx:"FX rate (1 GHS → JPY)",
      fxHint:"Used for profit conversion.",
      calc:"Calculate",
      result:"Result (decision first)",
      kTotalCost:"Total cost (JPY)",
      kRevenue:"Revenue (JPY)",
      kProfit:"Profit (JPY)",
      kMargin:"Profit margin",
      breakdown:"Breakdown (tap to open)",
      breakdownMini:"Decide by the result first. Open here only if you need details.",
      costSettings:"Cost settings",
      gbPct:"Gold Board fee (%)",
      exportPct:"Export & insurance (%)",
      otherGhs:"Other costs in Ghana (GHS)",
      taxPct:"Japan tax rate (%)",
      refine:"Refining cost (JPY / g)",
      otherJpy:"Other costs in Japan (JPY)",
      ghanaSide:"Ghana side (GHS)",
      japanSide:"Japan side (JPY)",
      g1:"Purchase subtotal",
      g2:"Gold Board fee",
      g3:"Export & insurance",
      g4:"Other costs",
      g5:"Ghana total cost",
      j1:"CIF taxable base (ref.)",
      j2:"Tax",
      j3:"Refining",
      j4:"Other costs",
      j5:"Japan total cost",
      footer:`Note: CIF taxable base is shown as a reference = Ghana total (GHS) × FX.`,
      warnNeed:"Some inputs are missing. Minimum: Buy price, Weight (pound or g), FX, and Japan sell price."
    }
  };

  function setLang(L){
    const t = i18n[L];
    $("tTitle").textContent = t.title;
    $("tSub").textContent = t.sub;
    $("tLangLabel").textContent = t.langLabel;

    $("tInput").textContent = t.input;
    $("tPricePound").textContent = t.pricePound;
    $("tPriceHint").textContent = t.priceHint;
    $("tSellJPYg").textContent = t.sellJPYg;
    $("tSellHint").textContent = t.sellHint;
    $("tWeightPound").textContent = t.weightPound;
    $("tWeightHint").textContent = t.weightHint;
    $("tWeightG").textContent = t.weightG;
    $("tConvertHint").textContent = t.convertHint;
    $("tFx").textContent = t.fx;
    $("tFxHint").textContent = t.fxHint;

    calcBtn.textContent = t.calc;

    $("tResult").textContent = t.result;
    $("kTotalCost").textContent = t.kTotalCost;
    $("kRevenue").textContent = t.kRevenue;
    $("kProfit").textContent = t.kProfit;
    $("kMargin").textContent = t.kMargin;

    $("tBreakdown").textContent = t.breakdown;
    $("tBreakdownMini").textContent = t.breakdownMini;
    $("tCostSettings").textContent = t.costSettings;

    $("tGbPct").textContent = t.gbPct;
    $("tExportPct").textContent = t.exportPct;
    $("tOtherGhs").textContent = t.otherGhs;
    $("tTaxPct").textContent = t.taxPct;
    $("tRefine").textContent = t.refine;
    $("tOtherJpy").textContent = t.otherJpy;

    $("tGhanaSide").textContent = t.ghanaSide;
    $("tJapanSide").textContent = t.japanSide;

    $("g1").textContent = t.g1;
    $("g2").textContent = t.g2;
    $("g3").textContent = t.g3;
    $("g4").textContent = t.g4;
    $("g5").textContent = t.g5;

    $("j1").textContent = t.j1;
    $("j2").textContent = t.j2;
    $("j3").textContent = t.j3;
    $("j4").textContent = t.j4;
    $("j5").textContent = t.j5;

    $("footerNote").textContent = t.footer;
  }

  function toNum(x){
    if(x === null || x === undefined) return NaN;
    const s = String(x).replace(/,/g,'').trim();
    if(!s) return NaN;
    const n = Number(s);
    return Number.isFinite(n) ? n : NaN;
  }

  function fmtJPY(n){
    if(!Number.isFinite(n)) return "-";
    return Math.round(n).toLocaleString("ja-JP") + " JPY";
  }
  function fmtGHS(n){
    if(!Number.isFinite(n)) return "-";
    return Math.round(n).toLocaleString("en-US") + " GHS";
  }
  function fmtPct(n){
    if(!Number.isFinite(n)) return "-";
    return (n*100).toFixed(2) + "%";
  }

  // Link: pound <-> gram (two-way)
  let lock = false;
  function syncFromPound(){
    if(lock) return;
    lock = true;
    const p = toNum(weightPound.value);
    if(Number.isFinite(p)){
      weightG.value = (p * GRAMS_PER_POUND).toFixed(4).replace(/\.?0+$/,'');
    } else {
      weightG.value = "";
    }
    lock = false;
  }
  function syncFromGram(){
    if(lock) return;
    lock = true;
    const g = toNum(weightG.value);
    if(Number.isFinite(g)){
      weightPound.value = (g / GRAMS_PER_POUND).toFixed(6).replace(/\.?0+$/,'');
    } else {
      weightPound.value = "";
    }
    lock = false;
  }

  function calc(){
    const L = lang.value;
    const t = i18n[L];

    const buyP = toNum(buyPerPound.value);     // GHS / pound
    const sell = toNum(sellJPYg.value);        // JPY / g
    const p = toNum(weightPound.value);
    const g = toNum(weightG.value);
    const fxv = toNum(fx.value);               // JPY per 1 GHS

    // settings
    const gb = toNum(gbPct.value);
    const exp = toNum(exportPct.value);
    const othG = toNum(otherGhs.value);
    const tax = toNum(taxPct.value);
    const ref = toNum(refineJPYg.value);
    const othJ = toNum(otherJpy.value);

    // choose grams
    const grams = Number.isFinite(g) ? g : (Number.isFinite(p) ? p*GRAMS_PER_POUND : NaN);
    const pounds = Number.isFinite(p) ? p : (Number.isFinite(g) ? g/GRAMS_PER_POUND : NaN);

    // minimal required
    const need =
      Number.isFinite(buyP) &&
      Number.isFinite(grams) &&
      Number.isFinite(fxv) &&
      Number.isFinite(sell);

    if(!need){
      warn.textContent = t.warnNeed;
      vTotalCost.textContent = "-";
      sTotalCost.textContent = "-";
      vRevenue.textContent = "-";
      sRevenue.textContent = "-";
      vProfit.textContent = "-";
      sProfit.textContent = "-";
      vMargin.textContent = "-";
      sMargin.textContent = "-";
      // breakdown blanks
      gBuy.textContent = "-"; gGb.textContent = "-"; gExp.textContent = "-"; gOther.textContent = "-"; gTotal.textContent = "-";
      jCIF.textContent = "-"; jTax.textContent = "-"; jRefine.textContent = "-"; jOther.textContent = "-"; jTotal.textContent = "-";
      return;
    }
    warn.textContent = "";

    // Ghana costs (GHS)
    const buySubtotalGHS = buyP * pounds;
    const gbFeeGHS = buySubtotalGHS * (Number.isFinite(gb) ? gb/100 : 0);
    const expFeeGHS = buySubtotalGHS * (Number.isFinite(exp) ? exp/100 : 0);
    const otherGHS = Number.isFinite(othG) ? othG : 0;
    const ghTotalGHS = buySubtotalGHS + gbFeeGHS + expFeeGHS + otherGHS;

    // Japan costs (JPY)
    const cifJPY = ghTotalGHS * fxv; // reference base
    const taxJPY = cifJPY * (Number.isFinite(tax) ? tax/100 : 0);
    const refineJPY = grams * (Number.isFinite(ref) ? ref : 0);
    const otherJPY = Number.isFinite(othJ) ? othJ : 0;
    const jpTotalJPY = cifJPY + taxJPY + refineJPY + otherJPY;

    // Revenue & profit
    const revenueJPY = sell * grams;
    const profitJPY = revenueJPY - jpTotalJPY;
    const margin = profitJPY / jpTotalJPY;

    // top
    vTotalCost.textContent = fmtJPY(jpTotalJPY);
    sTotalCost.textContent = `= (ガーナ総コストGHS × 為替) + 税 + 精錬 + 日本その他`;
    vRevenue.textContent = fmtJPY(revenueJPY);
    sRevenue.textContent = `= 売値(JPY/g) × 重さ(g)`;
    vProfit.textContent = fmtJPY(profitJPY);
    sProfit.textContent = `= 売上 - 総コスト`;
    vMargin.textContent = Number.isFinite(margin) ? fmtPct(margin) : "-";
    sMargin.textContent = `= 利益 ÷ 総コスト`;

    // breakdown
    gBuy.textContent = fmtGHS(buySubtotalGHS);
    gGb.textContent = fmtGHS(gbFeeGHS);
    gExp.textContent = fmtGHS(expFeeGHS);
    gOther.textContent = fmtGHS(otherGHS);
    gTotal.textContent = fmtGHS(ghTotalGHS);

    jCIF.textContent = fmtJPY(cifJPY);
    jTax.textContent = fmtJPY(taxJPY);
    jRefine.textContent = fmtJPY(refineJPY);
    jOther.textContent = fmtJPY(otherJPY);
    jTotal.textContent = fmtJPY(jpTotalJPY);
  }

  // Defaults
  function setDefaults(){
    // ここはあなたの“いつもの仮値”にしてOK
    fx.value = "18";
    gbPct.value = "10";
    exportPct.value = "6";
    otherGhs.value = "0";
    taxPct.value = "10";
    refineJPYg.value = "100";
    otherJpy.value = "0";
  }

  // Events
  weightPound.addEventListener("input", () => { syncFromPound(); calc(); });
  weightG.addEventListener("input", () => { syncFromGram(); calc(); });

  [buyPerPound, sellJPYg, fx, gbPct, exportPct, otherGhs, taxPct, refineJPYg, otherJpy].forEach(el=>{
    el.addEventListener("input", calc);
  });

  calcBtn.addEventListener("click", (e)=>{ e.preventDefault(); calc(); });

  lang.addEventListener("change", () => { setLang(lang.value); calc(); });

  // details chevron
  const detailWrap = $("detailWrap");
  const chev = $("chev");
  detailWrap.addEventListener("toggle", () => {
    chev.textContent = detailWrap.open ? "▲" : "▼";
  });

  // init
  setDefaults();
  setLang("ja");
  calc();
})();
</script>
</body>
</html>